#!/usr/bin/env ruby

require 'socket'

class TCPSocket
  def send_data(data)
    raw_data = data.split(', ').join.to_a.pack('H*') 
    write(raw_data)
    STDERR.puts "Sent data: #{data}"
  end

  def read_accept
    accept = read(1).unpack('H*')
    STDERR.puts "Accept: #{accept.join(', ')}"
  end
end

puts "Packet with engine off"
socket = TCPSocket.open('localhost', 5200)
socket.send_data("00, 0f, 33, 35, 36, 33, 30, 37, 30, 34, 31, 34, 37, 38, 34, 39, 35")
socket.read_accept
socket.send_data("00, 00, 00, 00, 00, 00, 00, 23, 08, 01, 00, 00, 01, 3b, 32, 7a, 84, ec, 00, 31, 66, f3, 00, 20, cf, 22, c0, 00, e1, 00, 00, 07, 00, 00, 00, 01, 01, 01, 00, 00, 00, 00, 01, 00, 00, 14, 27")
socket.close

puts "Packets with engine on"
socket = TCPSocket.open('localhost', 5200)
socket.send_data("00, 0f, 33, 35, 36, 33, 30, 37, 30, 34, 31, 34, 37, 38, 34, 39, 35")
socket.read_accept
socket.send_data("00, 00, 00, 00, 00, 00, 01, 43, 08, 0a, 00, 00, 01, 3b, 32, ba, 46, 9a, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, a0, 00, 00, 09, 00, 00, 00, 01, 01, 01, 00, 00, 00, 00, 00, 00, 01, 3b, 32, b8, 71, da, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, b1, 00, 00, 0a, 00, 00, 00, 01, 01, 01, 00, 00, 00, 00, 00, 00, 01, 3b, 32, b6, 9d, 1a, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, c5, 00, 00, 0a, 00, 00, 00, 01, 01, 01, 00, 00, 00, 00, 00, 00, 01, 3b, 32, b4, c8, 5a, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, cb, 00, 00, 0a, 00, 00, 00, 01, 01, 01, 00, 00, 00, 00, 00, 00, 01, 3b, 32, b2, f3, 9a, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, cd, 00, 00, 09, 00, 00, 00, 01, 01, 01, 01, 00, 00, 00, 00, 00, 01, 3b, 32, b2, cc, 8a, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, ca, 00, 00, 0a, 00, 00, 00, 01, 01, 01, 01, 00, 00, 00, 00, 00, 01, 3b, 32, b2, a5, 7a, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, c6, 00, 00, 0a, 00, 00, 00, 01, 01, 01, 01, 00, 00, 00, 00, 00, 01, 3b, 32, b2, 7e, 6a, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, c3, 00, 00, 0a, 00, 00, 00, 01, 01, 01, 01, 00, 00, 00, 00, 00, 01, 3b, 32, b2, 53, ae, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, c3, 00, 00, 0a, 00, 00, 00, 01, 01, 01, 01, 00, 00, 00, 00, 00, 01, 3b, 32, b2, 2c, 80, 00, 31, 66, e7, c0, 20, cf, 24, 00, 00, c2, 00, 00, 0a, 00, 00, 00, 01, 01, 01, 01, 00, 00, 00, 0a, 00, 00, 05, c0")
socket.close
